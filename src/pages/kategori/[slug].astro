---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { categories } from '../../data/categories';

export async function getStaticPaths() {
  return Object.keys(categories).map(slug => ({ params: { slug } }));
}

const { slug } = Astro.params;
const category = categories[slug as string];

if (!category) {
  return Astro.redirect('/404');
}

// Hämta alla inlägg i denna kategori
const allPosts = await getCollection('blog');
const posts = allPosts
  .filter(post => post.data.category?.toLowerCase() === slug)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<BaseLayout title={category.title} description={category.description}>

  <!-- Page Header -->
  <div class="blog-header">
    <div class="container">
      <div class="category-header-content">
        <div class="category-icon">
          {category.icon === 'home' && (
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
              <polyline points="9 22 9 12 15 12 15 22"/>
            </svg>
          )}
          {category.icon === 'zigbee' && (
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 4h16l-8 8 8 8H4l8-8z"/>
            </svg>
          )}
          {category.icon === 'matter' && (
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <circle cx="12" cy="12" r="4"/>
              <path d="M12 2v4M12 18v4M2 12h4M18 12h4"/>
            </svg>
          )}
          {category.icon === 'lightbulb' && (
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 18h6M10 22h4"/>
              <path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 18 8 6 6 0 0 0 6 8c0 1 .23 2.23 1.5 3.5A4.61 4.61 0 0 1 8.91 14"/>
            </svg>
          )}
          {category.icon === 'shield' && (
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
            </svg>
          )}
          {category.icon === 'thermometer' && (
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 14.76V3.5a2.5 2.5 0 0 0-5 0v11.26a4.5 4.5 0 1 0 5 0z"/>
            </svg>
          )}
          {category.icon === 'speaker' && (
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="4" y="2" width="16" height="20" rx="2" ry="2"/>
              <circle cx="12" cy="14" r="4"/>
              <line x1="12" y1="6" x2="12.01" y2="6"/>
            </svg>
          )}
        </div>
        <h1>{category.title}</h1>
        <p>{category.description}</p>
      </div>
    </div>
  </div>

  <!-- Articles -->
  <section class="section">
    <div class="container">
      {posts.length > 0 ? (
        <div class="articles-grid">
          {posts.map(post => (
            <a href={`/blog/${post.slug}`} class="article-card">
              <div class="article-card-image">
                {post.data.heroImage ? (
                  <img src={post.data.heroImage} alt={post.data.title} />
                ) : (
                  <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" opacity="0.3">
                      <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                      <polyline points="9 22 9 12 15 12 15 22"/>
                    </svg>
                  </div>
                )}
              </div>
              <div class="article-card-content">
                <h2 class="article-card-title">{post.data.title}</h2>
                <p class="article-card-excerpt">{post.data.description}</p>
                <div class="article-card-meta">
                  <span>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                      <line x1="16" y1="2" x2="16" y2="6"/>
                      <line x1="8" y1="2" x2="8" y2="6"/>
                      <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                    {new Intl.DateTimeFormat('sv-SE', {
                      year: 'numeric',
                      month: 'long',
                      day: 'numeric',
                    }).format(post.data.pubDate)}
                  </span>
                </div>
              </div>
            </a>
          ))}
        </div>
      ) : (
        <div class="empty-state">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
            <polyline points="10 9 9 9 8 9"/>
          </svg>
          <h2>Inga artiklar ännu</h2>
          <p>Vi har inte publicerat några artiklar i denna kategori ännu. Kom tillbaka snart!</p>
          <a href="/blog" class="btn btn-primary">
            Se alla guider
          </a>
        </div>
      )}
    </div>
  </section>

</BaseLayout>

<style>
  .category-header-content {
    max-width: 700px;
  }

  .category-icon {
    width: 64px;
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.15);
    border-radius: var(--radius-xl);
    margin-bottom: var(--spacing-6);
  }

  .category-icon svg {
    width: 32px;
    height: 32px;
    color: white;
  }

  .empty-state {
    text-align: center;
    padding: var(--spacing-16) var(--spacing-4);
  }

  .empty-state svg {
    margin: 0 auto var(--spacing-6);
    opacity: 0.3;
  }

  .empty-state h2 {
    font-size: var(--font-size-2xl);
    font-weight: 700;
    color: var(--color-gray-900);
    margin-bottom: var(--spacing-2);
  }

  .empty-state p {
    color: var(--color-gray-600);
    margin-bottom: var(--spacing-8);
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
  }

  /* Dark mode */
  :global([data-theme="dark"]) .empty-state h2 {
    color: #f8fafc;
  }

  :global([data-theme="dark"]) .empty-state p {
    color: #94a3b8;
  }
</style>
