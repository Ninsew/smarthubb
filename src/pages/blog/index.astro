---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog');
const posts = allPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<BaseLayout title="Guider & Artiklar" description="Utforska våra guider om smarta hem, Home Assistant, Zigbee, Matter och mycket mer.">

  <!-- Page Header -->
  <div class="blog-header">
    <div class="container">
      <h1>Guider & Artiklar</h1>
      <p>Praktiska guider, tips och nyheter för att hjälpa dig bygga ditt smarta hem.</p>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container section">
    <div class="blog-layout">

      <!-- Articles List -->
      <div class="blog-main">
        {posts.length > 0 ? (
          <div class="articles-grid">
            {posts.map(post => (
              <a href={`/blog/${post.slug}`} class="article-card">
                <div class="article-card-image">
                  {post.data.heroImage ? (
                    <img src={post.data.heroImage} alt={post.data.title} />
                  ) : (
                    <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
                      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" opacity="0.3">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                        <polyline points="9 22 9 12 15 12 15 22"/>
                      </svg>
                    </div>
                  )}
                  {post.data.category && (
                    <span class="article-card-category">{post.data.category}</span>
                  )}
                </div>
                <div class="article-card-content">
                  <h2 class="article-card-title">{post.data.title}</h2>
                  <p class="article-card-excerpt">{post.data.description}</p>
                  <div class="article-card-meta">
                    <span>
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                      </svg>
                      {new Intl.DateTimeFormat('sv-SE', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                      }).format(post.data.pubDate)}
                    </span>
                  </div>
                </div>
              </a>
            ))}
          </div>
        ) : (
          <div class="text-center" style="padding: var(--spacing-16) 0;">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" style="margin: 0 auto var(--spacing-6); opacity: 0.3;">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14 2 14 8 20 8"/>
              <line x1="16" y1="13" x2="8" y2="13"/>
              <line x1="16" y1="17" x2="8" y2="17"/>
              <polyline points="10 9 9 9 8 9"/>
            </svg>
            <p style="color: var(--color-gray-500);">Inga artiklar publicerade ännu.</p>
          </div>
        )}
      </div>

      <!-- Sidebar -->
      <aside class="blog-sidebar">
        <!-- Newsletter signup -->
        <div class="newsletter-widget">
          <h3>Prenumerera på nyhetsbrev</h3>
          <p>Få de senaste guiderna och tipsen direkt i din inkorg.</p>
          <form class="newsletter-form-sidebar" id="newsletter-form-sidebar">
            <input type="email" name="email" placeholder="Din e-postadress" required />
            <button type="submit">Prenumerera</button>
          </form>
        </div>

        <!-- Popular categories -->
        <div class="sidebar-widget">
          <h3 class="sidebar-widget-title">Kategorier</h3>
          <ul class="sidebar-categories">
            <li><a href="/kategori/home-assistant">Home Assistant</a></li>
            <li><a href="/kategori/zigbee">Zigbee</a></li>
            <li><a href="/kategori/matter">Matter</a></li>
            <li><a href="/kategori/belysning">Belysning</a></li>
            <li><a href="/kategori/sakerhet">Säkerhet</a></li>
          </ul>
        </div>

        <!-- Ad placeholder -->
        <div class="sidebar-widget">
          <h3 class="sidebar-widget-title">Annons</h3>
          <div class="ad-placeholder" style="min-height: 250px;">
            Annonsplats
          </div>
        </div>
      </aside>

    </div>
  </div>

</BaseLayout>

<style>
  .blog-main {
    min-width: 0;
  }

  .sidebar-categories {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .sidebar-categories li {
    margin-bottom: var(--spacing-2);
  }

  .sidebar-categories a {
    display: flex;
    align-items: center;
    padding: var(--spacing-2) var(--spacing-3);
    color: var(--color-gray-700);
    border-radius: var(--radius-md);
    transition: all var(--transition-fast);
  }

  .sidebar-categories a:hover {
    background: var(--color-primary-50);
    color: var(--color-primary-700);
  }

  @media (min-width: 1024px) {
    .articles-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  /* Dark mode */
  :global([data-theme="dark"]) .sidebar-categories a {
    color: #cbd5e1;
  }

  :global([data-theme="dark"]) .sidebar-categories a:hover {
    background: rgba(6, 182, 212, 0.1);
    color: var(--color-primary-400);
  }
</style>
